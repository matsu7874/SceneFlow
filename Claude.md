# SceneFlow 開発状況分析

## 現在の実装状況と必要な開発項目

### 1. タイムライン管理機能

#### 実装済み ✅
- 時系列でのAct配置機能（`src/modules/ui/timelineEditor.ts`）
- Act の追加・削除・並び替え
- ドラッグ&ドロップでの編集機能（`src/modules/ui/dragDrop.ts`）

#### 要開発 🔲
- **キャラクターごとの行動履歴表示の拡張**
  - 現在はAct単位の表示のみで、キャラクター視点での時系列表示が不足
- **移動時間の自動計算と反映**
  - ロケーション間の移動時間が未実装

### 2. キャラクター管理機能

#### 実装済み ✅
- Person型の基本定義（`src/types/index.ts`）
- 初期位置設定（InitialState）

#### 要開発 🔲
- **詳細プロフィール管理**
  - 現在は名前とカラーのみ、持ち物などの属性が不足
- **関連イベント・シーンの一覧表示UI**
- **セリフ・台本管理機能**
- **ハンドアウト出力機能**

### 3. シーン管理機能

#### 実装済み ✅
- Act として基本的なシーン概念は実装済み
- 場所・時間・人物の関連付け

#### 要開発 🔲
- **シーンという独立した概念の追加**
  - 複数のActをグループ化するシーン管理
- **シーン削除時の依存関係チェック**
  - 現在は因果律エンジンで部分的に実装済みだが、シーン単位での管理が必要

### 4. アイテム管理機能

#### 実装済み ✅
- ExtendedProp型で大道具・小道具の区別（`src/types/extendedEntities.ts`）
- アイテムの受け渡しAct（GiveItemAct, TakeItemAct, PlaceItemAct）
- 所有権・位置の追跡（WorldState内）

#### 要開発 🔲
- **アイテム中心のビュー**
  - 現在は状態の一部として管理されているが、専用UIが不足
- **アイテムの生成・廃棄の記録**
  - UseItemActで消費は実装済みだが、生成の仕組みが不完全

### 5. ロケーション管理機能

#### 実装済み ✅
- 基本的な接続関係（connections配列）
- 場所のレイアウト表示（`src/modules/ui/layout.ts`）

#### 要開発 🔲
- **移動時間の設定と管理**
  - 接続に移動時間の属性が不足
- **マップビューの実装**
  - ノードベースの可視化（Phase 6で計画済み）
- **経路探索機能**

### 6. 情報・小道具の整合性チェック機能

#### 実装済み ✅
- 因果律エンジンによる基本的な整合性チェック（`src/modules/causality/engine.ts`）
- 事前条件・事後条件の検証
- 因果ビューでの依存関係追跡（`src/modules/ui/causalityView.ts`）

#### 要開発 🔲
- **経路削除時の警告UI**
- **修正候補の自動提示機能の拡張**

### 7. データ管理機能

#### 実装済み ✅
- JSONインポート・エクスポート基本機能
- LocalStorageでの状態保存（`src/modules/state/extendedState.ts`）

#### 要開発 🔲
- **複数フォーマット対応**（YAML, CSV）
- **部分的なインポート・エクスポート**
- **バージョン管理・差分表示**

## 推奨開発優先順位

### Phase 1: 基本機能の補完（1-2週間）
1. **移動時間の実装**
   - Location型に`travelTimes: Record<LocationId, number>`を追加
   - MoveActで移動時間を自動計算
   
2. **キャラクター詳細プロフィール**
   - Person型の拡張（初期持ち物、属性）
   - プロフィール編集UI

3. **シーン管理の実装**
   - Scene型の追加
   - Actのグループ化機能

### Phase 2: UI/UXの強化（2-3週間）
1. **キャラクター中心ビュー**
   - 特定キャラクターの行動履歴タイムライン
   - 関連イベント一覧

2. **アイテム中心ビュー**
   - アイテムの所有履歴
   - 受け渡しフロー可視化

3. **セリフ・台本管理**
   - Act に dialogue フィールド追加
   - 台本エクスポート機能

### Phase 3: 高度な機能（3-4週間）
1. **マップエディタ**（Phase 6の実装）
   - ノードベースの場所編集
   - 移動経路の可視化

2. **高度なデータ管理**
   - YAML/CSVサポート
   - 差分表示機能

3. **ハンドアウト生成**
   - キャラクターごとの情報整理
   - PDF/HTML出力

## 技術的な推奨事項

1. **型定義の拡張**
   - Scene, Dialogue, CharacterProfile などの新しい型を追加
   - 既存の型を拡張する際は後方互換性を維持

2. **UIコンポーネントの整理**
   - 各ビュー（キャラクター、アイテム、シーン）を独立したモジュールとして実装
   - 共通UIコンポーネントの抽出

3. **データ永続化の強化**
   - IndexedDBの活用検討
   - オートセーブ機能の実装

4. **テストの拡充**
   - 新機能ごとにユニットテストを追加
   - E2Eテストでユーザーシナリオをカバー
