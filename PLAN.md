# SceneFlow 実装計画

## データ構造の改善

- [x] Move/Stay型を削除し、Actのバリアントとして管理
- [x] eventsフィールドを削除し、actsから自動生成するように変更

## バグ修正

- [x] locationで接続を追加してもシミュレーションに反映されない不具合
- [x] 人物の「関係性」タイプを自由入力にする
- [ ] 物語データロード後の画面が真っ白になる問題
  - [x] 因果関係ビュー：eventsフィールドがないことによるエラー → 修正を試みたが問題継続中
  - [x] エンティティ編集：eventsフィールドがないことによるエラー → 修正済み
  - [x] 検証：eventsフィールドがないことによるエラー → 修正済み

## 修正済み項目 ✅

- [x] EventLogコンポーネント：eventsフィールドを参照していない（確認済み）
- [x] SimulationControls：eventsフィールドを参照していない（確認済み）
- [x] ImportExportManager：eventsフィールドは直接参照していない（確認済み）
- [x] act.startTimeをact.timeに修正
- [x] CausalityEngineのact.startTime/endTime参照を修正

## 現在の問題と調査結果 🔍

### ✅ 因果関係ビューの白い画面問題（解決済み）
問題の原因：
- `node.data.id.slice(0, 8)`でエラーが発生
- `node.data.id`が数値型の場合、`slice`メソッドが使用できない

解決方法：
- `String(node.data.id).slice(0, 8)`に修正
- エラーバウンダリを追加して問題を特定

結果：
- 因果関係ビューが正常に表示されるようになった
- ノード（ActとEvent）と関係性が可視化されている

## 完了したタスク ✅

- [x] 因果関係ビューの白い画面問題を解決
- [x] node.data.id.sliceエラーを修正
- [x] CSSのpointer-events問題を修正（SVGがcanvasのイベントを妨げないように）

## 残りの軽微な問題

- 一部のE2Eテストが失敗（主にUI操作のタイミング問題）
- ヘッダーが一部のノードと重なる場合がある

## テスト

- [x] events自動生成機能の単体テスト作成・実行済み
- [ ] 各ページが正常に表示されることの確認
- [ ] すべてのE2Eテストが成功することの確認