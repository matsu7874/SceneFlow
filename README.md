# SceneFlow - イマーシブシアターシミュレーター

SceneFlowは、複数の登場人物が異なる場所で同時進行する物語を設計・シミュレーションするためのツールです。イマーシブシアター（没入型演劇）や複雑なストーリーの構造を可視化し、検証することができます。

## 🎭 SceneFlowとは

イマーシブシアターでは、観客が自由に移動しながら物語を体験します。複数の登場人物が同時に異なる場所で行動するため、物語の全体像を把握することが困難です。SceneFlowは、このような複雑な物語構造を：

- **視覚的に設計** - マップエディタで場所の配置と接続を作成
- **時系列で管理** - タイムラインに沿って行動を配置
- **リアルタイムシミュレーション** - 実際の上演のように物語を再生
- **検証とデバッグ** - 矛盾や問題を自動的に検出

## 🚀 クイックスタート

### オンライン版を使う（推奨）

1. ブラウザで https://matsu7874.github.io/scene-flow/ にアクセス
2. サンプルデータをロードするか、新規作成を開始

### ローカルで実行する

```bash
# リポジトリをクローン
git clone https://github.com/matsu7874/scene-flow.git
cd scene-flow

# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev
```

ブラウザで http://localhost:3000 を開きます。

## 📖 使い方

### 1. シミュレーションタブ

メイン画面では物語データの読み込みとシミュレーションを行います。

#### データの読み込み
1. テキストエリアにJSONデータを貼り付け
2. 「物語データをロード」ボタンをクリック
3. または「サンプルデータ」から選択

#### シミュレーション操作
- **▶ Play / ⏸ Pause** - シミュレーションの再生/一時停止
- **速度調整** - 0.5x〜20xまで再生速度を変更
- **タイムライン** - スライダーで任意の時刻にジャンプ

#### 表示内容
- **場所別ビュー** - 各場所にいる人物をリアルタイム表示
- **実行ログ** - 発生した行動を時系列で表示

### 2. 因果関係ビュー

物語の因果関係を視覚的に表示します。

- **青色のノード** - Acts（行動）
- **紫色のノード** - Events（イベント）
- **矢印** - 因果関係の流れ

#### 操作方法
- **ドラッグ** - ビューを移動
- **マウスホイール** - ズームイン/アウト
- **ノードクリック** - 詳細情報を表示
- **Reset View** - 表示をリセット

### 3. エンティティ編集

物語の要素を作成・編集します。

#### 人物（Persons）
- **基本情報** - 名前、色、説明
- **属性** - 年齢、職業、性格
- **関係性** - 他の人物との関係を定義

#### 場所（Locations）
- **基本情報** - 名前、説明、タイプ
- **接続** - 他の場所との接続関係
- **座標** - マップ上の位置（x, y）

#### 小道具（Props）
- **基本情報** - 名前、説明、カテゴリ
- **属性** - 持ち運び可能、消費可能、組み合わせ可能
- **位置** - 現在の場所または所有者

#### 情報（Information）
- **内容** - 情報の詳細
- **カテゴリ** - 事実、噂、秘密など
- **効果** - この情報が可能にする行動

#### 行動（Acts）
- **実行者** - 誰が行うか
- **場所** - どこで行うか
- **時刻** - いつ行うか（HH:MM:SS形式）
- **説明** - 何をするか

### 4. マップエディタ

場所の配置と接続を視覚的に編集します。

#### 操作方法
- **場所を追加** - 「場所を追加」ボタンをクリック後、マップ上をクリック
- **場所を移動** - ドラッグで位置を変更
- **接続を作成** - 場所をクリックして選択し、別の場所をクリック
- **場所を削除** - 場所を選択して「削除」ボタン
- **グリッド表示** - グリッドの表示/非表示を切り替え

#### 自動レイアウト
- **円形配置** - 場所を円形に配置
- **グリッド配置** - 場所を格子状に配置
- **階層配置** - 接続関係に基づいて階層的に配置

### 5. 関係性

登場人物間の関係を管理します。

- 関係の種類を自由に定義（友人、恋人、敵対など）
- 双方向の関係を視覚的に表示
- 関係性に基づいた行動の設計が可能

### 6. 検証

物語データの整合性をチェックします。

#### 検出される問題
- **エラー（赤）**
  - 重複したID
  - 存在しない参照
  - 必須フィールドの欠如

- **警告（黄）**
  - 孤立した場所
  - 時間の重複
  - 未使用の要素

- **情報（青）**
  - 最適化の提案
  - 構造の改善案

## 📊 データ形式

### 基本構造

```json
{
  "persons": [...],      // 登場人物
  "locations": [...],    // 場所
  "props": [...],        // 小道具
  "informations": [...], // 情報
  "acts": [...],         // 行動
  "initialStates": [...] // 初期配置
}
```

### 詳細な例

```json
{
  "persons": [
    {
      "id": 1,
      "name": "主人公",
      "color": "#FF0000",
      "description": "物語の主人公",
      "age": 25,
      "occupation": "探偵",
      "personality": "冷静沈着",
      "relationships": [
        {
          "targetId": "2",
          "type": "協力者"
        }
      ]
    }
  ],
  "locations": [
    {
      "id": 1,
      "name": "事務所",
      "connections": [2],
      "description": "探偵事務所",
      "type": "indoor",
      "x": 100,
      "y": 200
    }
  ],
  "acts": [
    {
      "id": 1,
      "personId": 1,
      "locationId": 1,
      "time": "09:00:00",
      "description": "事件の依頼を受ける"
    }
  ],
  "initialStates": [
    {
      "personId": 1,
      "locationId": 1,
      "time": "00:00:00"
    }
  ]
}
```

## 💡 活用例

### イマーシブシアター
- 複数の観客が同時に体験する物語の設計
- 各場所での出来事のタイミング調整
- 観客の動線と物語の流れの最適化

### ゲームシナリオ
- NPCの行動パターン設計
- 時間経過による世界の変化
- プレイヤーの選択による分岐の管理

### 映画・ドラマの脚本
- 群像劇の時系列管理
- 同時進行するシーンの把握
- 登場人物の行動の整合性チェック

## ⚙️ 詳細設定

### パフォーマンス
- 最大500人の登場人物
- 最大1000の場所
- 最大10000の行動

### データ制限
- JSONファイルサイズ: 最大10MB
- インポート時の自動バックアップ

### キーボードショートカット
- `Space` - 再生/一時停止
- `←/→` - 時間を進める/戻す
- `Ctrl+S` - データを保存（ダウンロード）
- `Ctrl+O` - データを開く

## 🔧 トラブルシューティング

### よくある問題

**Q: データがロードされない**
- JSONフォーマットが正しいか確認
- 必須フィールド（id, name等）が含まれているか確認
- ブラウザのコンソールでエラーを確認

**Q: シミュレーションが動かない**
- actsに時刻（time）が設定されているか確認
- initialStatesが設定されているか確認
- 人物と場所のIDが正しく対応しているか確認

**Q: 場所が表示されない**
- locationsに座標（x, y）が設定されているか確認
- マップエディタで「自動レイアウト」を試す

## 🤝 貢献

バグ報告や機能要望は [GitHub Issues](https://github.com/matsu7874/scene-flow/issues) にお寄せください。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。
