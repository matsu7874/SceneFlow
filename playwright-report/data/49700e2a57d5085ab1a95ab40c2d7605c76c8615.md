# Test info

- Name: Entity Editor >> displays entities and allows creation
- Location: /Users/matsumoto/private/scene-flow/e2e/entity-editor-final.spec.ts:30:7

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toHaveCount(expected)

Locator: locator('.entity-group')
Expected: 6
Received: 0
Call log:
  - expect.toHaveCount with timeout 5000ms
  - waiting for locator('.entity-group')
    9 × locator resolved to 0 elements
      - unexpected value "0"

    at /Users/matsumoto/private/scene-flow/e2e/entity-editor-final.spec.ts:46:49
```

# Page snapshot

```yaml
- banner:
  - heading "Scene-Flow" [level=1]
  - navigation:
    - heading "Scene-Flow" [level=1]
    - link "Simulation":
      - /url: /
    - link "Causality View":
      - /url: /causality
    - link "Entity Editor":
      - /url: /entities
    - link "Map Editor":
      - /url: /map-editor
    - link "Relationships":
      - /url: /relationships
    - link "Validation":
      - /url: /validation
- main:
  - heading "Entity Management" [level=2]
  - paragraph: No data loaded. Please go to the Simulation page and load some story data first.
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test'
   2 |
   3 | // Test data
   4 | const testStoryData = {
   5 |   persons: [
   6 |     { id: 'alice', name: 'Alice' },
   7 |     { id: 'bob', name: 'Bob' }
   8 |   ],
   9 |   locations: [
  10 |     { id: 'room1', name: 'Living Room', connectedTo: ['room2'] },
  11 |     { id: 'room2', name: 'Kitchen', connectedTo: ['room1'] }
  12 |   ],
  13 |   props: [
  14 |     { id: 'key1', name: 'Golden Key' }
  15 |   ],
  16 |   informations: [
  17 |     { id: 'info1', content: 'The treasure is hidden in the basement' }
  18 |   ],
  19 |   acts: [
  20 |     { id: 'act1', type: 'move', personId: 'alice', locationId: 'room1' }
  21 |   ],
  22 |   events: [
  23 |     { id: 'event1', trigger: { type: 'time', time: 300 } }
  24 |   ],
  25 |   relationships: [],
  26 |   connections: []
  27 | }
  28 |
  29 | test.describe('Entity Editor', () => {
  30 |   test('displays entities and allows creation', async ({ page }) => {
  31 |     // Load data first
  32 |     await page.goto('/simulation')
  33 |     const jsonInput = page.locator('textarea').first()
  34 |     await jsonInput.fill(JSON.stringify(testStoryData, null, 2))
  35 |     await page.getByRole('button', { name: '物語データをロード' }).click()
  36 |     await page.waitForTimeout(1000)
  37 |     
  38 |     // Navigate to entities
  39 |     await page.getByRole('link', { name: 'Entity Editor' }).click()
  40 |     await expect(page).toHaveURL(/\/entities/)
  41 |     
  42 |     // Verify page loaded
  43 |     await expect(page.locator('h2:has-text("Entity Management")')).toBeVisible()
  44 |     
  45 |     // Check that entities are displayed (use flexible matching)
> 46 |     await expect(page.locator('.entity-group')).toHaveCount(6) // 6 entity types
     |                                                 ^ Error: Timed out 5000ms waiting for expect(locator).toHaveCount(expected)
  47 |     await expect(page.locator('.entity-item:has-text("Alice")')).toBeVisible()
  48 |     await expect(page.locator('.entity-item:has-text("Bob")')).toBeVisible()
  49 |     await expect(page.locator('.entity-item:has-text("Living Room")')).toBeVisible()
  50 |     
  51 |     // Create new entity
  52 |     await page.getByRole('button', { name: '+ New Entity' }).click()
  53 |     await expect(page.locator('text=Create New Entity')).toBeVisible()
  54 |     
  55 |     // Create a person
  56 |     await page.locator('.type-button:has-text("Person")').click()
  57 |     
  58 |     // Verify new entity is created and selected
  59 |     await expect(page.locator('h3:has-text("Edit person: New person")')).toBeVisible()
  60 |     
  61 |     // Edit the entity
  62 |     await page.getByLabel('Name').clear()
  63 |     await page.getByLabel('Name').fill('Charlie')
  64 |     await page.getByRole('button', { name: 'Save' }).click()
  65 |     
  66 |     // Verify save
  67 |     await expect(page.locator('text=person saved successfully')).toBeVisible()
  68 |     await expect(page.locator('.entity-item:has-text("Charlie")')).toBeVisible()
  69 |   })
  70 |   
  71 |   test('shows no data message when empty', async ({ page }) => {
  72 |     await page.goto('/entities')
  73 |     await expect(page.locator('text=No data loaded')).toBeVisible()
  74 |   })
  75 | })
```